---

title: Title

keywords: fastai
sidebar: home_sidebar

summary: "summary"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02_protocols.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Protocols">Protocols<a class="anchor-link" href="#Protocols">&#182;</a></h1><p>Using Protocol Buffer to setup the types of objects I need:</p>
<ul>
<li>subject</li>
<li>treatment</li>
<li>model</li>
<li>evaluation</li>
<li>expectation</li>
<li>invocation</li>
</ul>
<p>There could be more, but this handles the lifecycle of a data product:</p>
<ul>
<li>Define the data or type of data we're working with. This can come across a stream, be found in file, or resemble academic data sets.</li>
<li>Learn how to learn from the data, defining a treatment that builds a model, applies a heuristic, or somehow transforms the data.</li>
<li>Store a model with its meta data, so we know what it is, when it was built, how it was built, etc.</li>
<li>Store evaluations of data transforms in standard ways, so they can be used in reporting and progress management.</li>
<li>Convert data into data expectations. This works on input data to a model as well as output data from a model. This can define a distribution, or any rules that make the data valid or alarming.</li>
<li>Create external interfaces to functions, models, and API calls. This is especially useful with all of my open keyword function signatures.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="serialize" class="doc_header"><code>serialize</code><a href="https://github.com/davidrichards/data_lab/tree/master/data_lab/train/protocols.py#L11" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>serialize</code>(<strong><code>message</code></strong>)</p>
</blockquote>
<p>Convert a message to a binary string.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="deserialize" class="doc_header"><code>deserialize</code><a href="https://github.com/davidrichards/data_lab/tree/master/data_lab/train/protocols.py#L29" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>deserialize</code>(<strong><code>s</code></strong>, <strong><code>kind</code></strong>)</p>
</blockquote>
<p>Deserialize a string as a kind of message.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compress" class="doc_header"><code>compress</code><a href="https://github.com/davidrichards/data_lab/tree/master/data_lab/train/protocols.py#L44" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compress</code>(<strong><code>message</code></strong>, <strong><code>level</code></strong>=<em><code>9</code></em>)</p>
</blockquote>
<p>Compress a message.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="decompress" class="doc_header"><code>decompress</code><a href="https://github.com/davidrichards/data_lab/tree/master/data_lab/train/protocols.py#L50" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>decompress</code>(<strong><code>compressed</code></strong>, <strong><code>kind</code></strong>)</p>
</blockquote>
<p>Decompress a compressed message, given the kind of message.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="to_dict" class="doc_header"><code>to_dict</code><a href="https://github.com/davidrichards/data_lab/tree/master/data_lab/train/protocols.py#L57" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>to_dict</code>(<strong><code>message</code></strong>)</p>
</blockquote>
<p>Create a dictionary from a message, including all defaults.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">_kind_to_class</span><span class="p">(</span><span class="n">training_prototypes</span><span class="o">.</span><span class="n">Subject</span><span class="p">)</span> <span class="o">==</span> <span class="n">training_prototypes</span><span class="o">.</span><span class="n">Subject</span>
<span class="k">assert</span> <span class="n">_kind_to_class</span><span class="p">(</span><span class="s1">&#39;Subject&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">training_prototypes</span><span class="o">.</span><span class="n">Subject</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MessageBuilder" class="doc_header"><code>class</code> <code>MessageBuilder</code><a href="https://github.com/davidrichards/data_lab/tree/master/data_lab/train/protocols.py#L63" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MessageBuilder</code>(<strong>**<code>kw</code></strong>)</p>
</blockquote>
<p>Create Protocol Buffer messages from Python
data types.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">evaluations</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]}])</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">model_builder</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
<span class="n">serialized</span> <span class="o">=</span> <span class="n">serialize</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="n">compressed</span> <span class="o">=</span> <span class="n">compress</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="n">decompressed</span> <span class="o">=</span> <span class="n">decompress</span><span class="p">(</span><span class="n">compressed</span><span class="p">,</span> <span class="n">training_prototypes</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">decompressed</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span>
<span class="k">assert</span> <span class="n">decompressed</span><span class="o">.</span><span class="n">evaluations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;accuracy&#39;</span>
<span class="k">assert</span> <span class="s1">&#39;version&#39;</span> <span class="ow">in</span> <span class="n">to_dict</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So, serializing, deserializing, compressing, and decompressing all work. Also, creating a dictionary from a message works, even with defaults.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">MessageBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">_message_class</span> <span class="o">==</span> <span class="n">MessageBuilder</span><span class="o">.</span><span class="n">DEFAULT_MESSAGE_CLASS</span>
<span class="k">assert</span> <span class="n">MessageBuilder</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="n">training_prototypes</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span><span class="o">.</span><span class="n">_message_class</span> <span class="o">==</span> <span class="n">training_prototypes</span><span class="o">.</span><span class="n">Model</span>
<span class="k">assert</span> <span class="n">MessageBuilder</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;Model&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">_message_class</span> <span class="o">==</span> <span class="n">training_prototypes</span><span class="o">.</span><span class="n">Model</span>
<span class="k">assert</span> <span class="n">MessageBuilder</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="n">training_prototypes</span><span class="o">.</span><span class="n">Evaluation</span><span class="p">)</span><span class="o">.</span><span class="n">_message_class</span> <span class="o">==</span> <span class="n">training_prototypes</span><span class="o">.</span><span class="n">Evaluation</span>
<span class="k">assert</span> <span class="n">MessageBuilder</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;Evaluation&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">_message_class</span> <span class="o">==</span> <span class="n">training_prototypes</span><span class="o">.</span><span class="n">Evaluation</span>

<span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas commodo sem id mi fringilla volutpat. Etiam sed massa sapien. Curabitur elementum, quam id feugiat tristique, tellus mauris pretium sem, sit amet congue elit lectus non dolor. Suspendisse imperdiet lectus at est posuere, vel suscipit arcu rhoncus. Integer ultricies laoreet erat eu laoreet. Pellentesque nec metus scelerisque, dignissim quam ut, suscipit magna. Sed nec purus ut felis eleifend volutpat.</span>

<span class="s2">Mauris consectetur metus a finibus pellentesque. Nunc eleifend tempus mollis. Nullam eget interdum enim. Sed nunc lorem, elementum vel pretium in, luctus eu turpis. In hac habitasse platea dictumst. Curabitur tincidunt placerat est, eu imperdiet enim cursus laoreet. Nam placerat varius lacus, at laoreet felis facilisis ut. Vestibulum vitae eros ante. Vestibulum mattis sem ut lacus posuere, at tincidunt augue imperdiet. Nulla congue erat vitae suscipit ultrices. Maecenas gravida egestas magna eget condimentum. Morbi vitae varius magna. Pellentesque ut diam magna. Etiam justo nibh, aliquet eget finibus at, finibus ac quam. Sed nec porta justo, ac aliquet sem. Donec sit amet elit lobortis, volutpat sapien eget, ullamcorper erat.</span>

<span class="s2">Nullam eu quam porttitor, rhoncus dolor id, rhoncus nulla. Morbi et elementum nunc. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Sed imperdiet nulla nunc, vel sollicitudin libero dapibus sed. Curabitur ultrices ante at gravida rhoncus. Nunc quis ante convallis, dapibus mi sit amet, efficitur ex. Ut magna est, egestas sit amet scelerisque sit amet, finibus a lectus. Sed vitae dignissim leo. Sed laoreet ante et sem convallis auctor. Morbi sodales ut magna ultrices sodales. Integer luctus blandit nunc. Sed a dapibus massa. Suspendisse rhoncus erat lacus, quis facilisis dui ornare dignissim. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Curabitur purus ante, vulputate at justo in, egestas egestas ante. Duis vitae est rutrum, luctus erat eget, luctus enim.</span>

<span class="s2">Aliquam eu neque nisl. Ut egestas, dui nec posuere sagittis, justo massa gravida velit, a pulvinar urna turpis in elit. Integer ex orci, scelerisque non felis quis, ornare aliquet quam. Fusce at metus at risus auctor interdum a eget ante. Aenean congue, risus ac rutrum gravida, leo tellus ullamcorper nisi, quis aliquet justo orci ut ex. Morbi sagittis augue ac dui posuere, quis vestibulum dui finibus. Nam elementum ex non diam sollicitudin, sit amet finibus velit convallis. Vivamus viverra, ipsum quis cursus tempor, neque erat tincidunt elit, a tempor dolor enim quis nibh. Morbi vestibulum massa sed tempus hendrerit. Quisque aliquet metus feugiat, pellentesque nisl id, rutrum quam. Nulla sit amet dapibus ipsum. Morbi ut lorem aliquam, lacinia tortor vitae, luctus mauris. Maecenas vehicula elementum justo gravida luctus. Maecenas suscipit pellentesque nisi ut rutrum. Praesent a convallis quam.</span>

<span class="s2">Donec at nisi eros. Vestibulum sed libero vitae nunc posuere aliquet. Aliquam erat volutpat. Sed lorem felis, sagittis et pulvinar id, posuere sed arcu. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec vitae dolor vulputate, iaculis velit fermentum, posuere ante. Aenean erat nisl, feugiat ac interdum sed, fringilla vitae purus. Curabitur pulvinar aliquam dui, eget suscipit augue volutpat id. Nullam auctor mollis mi, vel sodales erat scelerisque vel. Aliquam bibendum purus eu feugiat hendrerit. Pellentesque id ultrices ante. Nullam non mauris a nibh finibus commodo. Fusce vel purus vitae tortor vestibulum scelerisque sed eu erat. In hac habitasse platea dictumst. Ut feugiat magna nunc, eget tempor sapien commodo nec. Donec tincidunt augue at leo scelerisque euismod.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">model_builder</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">description</span> <span class="o">==</span> <span class="n">description</span>
<span class="k">assert</span> <span class="n">model_builder</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">evaluations</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]}])</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">model_builder</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">evaluations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>
 

